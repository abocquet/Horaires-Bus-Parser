(function(){function e(e,t){var n=new XMLHttpRequest;n.open("GET",e);n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){t(n.responseText)}};n.send(null)}function t(e,t){var n=Math.PI/180,r=e.latitude*n,i=t.latitude*n,s=t.longitude*n,o=t.longitude*n,u=Math.sin(r)*Math.sin(i),a=Math.cos(r)*Math.cos(i),f=Math.cos(s-o),l=a*f,c=u+l,h=Math.atan(-c/Math.sqrt(-c*c+1))+2*Math.atan(1);return h*3437.74677*1.1508*1.6093470878864446}function n(e,t){if(!navigator.geolocation){t("Votre appareil ne dispose pas de géolocalisation")}navigator.geolocation.getCurrentPosition(function(t){e(t.coords)},function(e){var n="Erreur lors de la géolocalisation : ";switch(e.code){case e.TIMEOUT:n+="La localisation prend trop de temps";break;case e.PERMISSION_DENIED:n+="Vous n’avez pas donné la permission";break;case e.POSITION_UNAVAILABLE:n+="La position n’a pu être déterminée";break;case e.UNKNOWN_ERROR:n+="Erreur inconnue";break}t(n)},{enableHighAccuracy:true})}function r(){o.state.textContent="Chargement en cours";o.horaires.container.innerHTML="";o.arret.textContent="";var t=null,r=null;var s=function(e){o.state.textContent=e?e:"An error ocurred during the process. Like the rabbit."};e("/horaires",function(e){t=JSON.parse(e);i(t,r)});n(function(e){r=e;i(t,r)},s)}var i=function(e,n){if(!e||!n){return false}var r={distance:1e6,name:"42",ville:"Montréal",horaires:{0:[],1:[]}};for(var i in e){var o=t(n,e[i]);if(o<r.distance){r=e[i];r.distance=o}}if(u==0){u=r.sens}s(r,u)};var s=function(e,t){console.log(e);o.arret.textContent="Arret de "+e.name+" ("+e.ville+") en direction de "+(t<2?"Grenoble":"Crolles");for(var n=0,r=e.horaires[t].length;n<r;n++){var i=document.createElement("li");i.textContent=e.horaires[t][n];o.horaires.container.appendChild(i)}o.state.textContent=""};var o={state:document.querySelector("#state"),arret:document.querySelector("#arret"),horaires:{container:document.querySelector("ul"),hiddens:[]},buttons:{more:document.querySelector("input#more"),change:document.querySelector("input#change"),refresh:document.querySelector("input#refresh")}};var u=0;o.buttons.change.onclick=function(){u=u==1?2:1;r()};o.buttons.refresh.onclick=function(){r()};r()})()